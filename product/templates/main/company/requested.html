{% extends 'main/base.html' %}
{% load staticfiles %}
{% block company %}
<div class="company-head"  style="background-image: {% if object.cover %}url('{{object.cover.url}}'){% else %} url('{% static 'img/product-img/pro-big-1.jpg' %}'){% endif %};">
    
    
    
        
      <div class="company-logo">
        {% if object.logo %}
        <img  src="{{object.logo.url}}"  >
        {% else %}
        
        <h1 style="text-align: center; color: #717571;">{{object.name|title}}</h1>
        {% endif %}
    </div>
    {% if object == user.company %}
    <div class="profile-link">
        <a class="" href="{% url 'products:create'  %}"> <i class="icon ion-plus"></i><span>Add Product</span></a><a class="" href="{% url 'company:update'  %}">  
				  <i class="ion ion-edit"
	></i>	<span>Update Store Info</span>	</a>
    </div>
  {% endif %}
    
   
</div>
{% endblock company %}
{% block content %}
{{block.super}}





<section class="courses">
    <div class="row ">
        <div class="col-12">
          
                    
                    <a href="/{{object.slug}}/account/" class="btn btn-main" style=" float:left;  border-color: #30323A; margin: 5px;">My Company Finance</a>
                    <a href="/{{object.slug}}/requested/" class="btn btn-main" style="float:left; border-color:#30323A; background-color: #30323A; margin: 5px;;">Recent Orders</a>
                    <a href="/{{object.slug}}/delivered/" class="btn btn-main" style=" float:left;  border-color: #30323A; margin: 5px;">Delivered Orders</a>
                    <a href="/{{object.slug}}/returned/" class="btn btn-main" style="float:left; border-color:#30323A;; margin: 5px;;">Returned Orders</a>
               
                <!-- Sorting -->
               
        </div>
    </div>
<div id="store">
    <!-- row -->
    
    <div class="sale-record">
        
    <!-- Single Product Area -->
   
    <!-- Single Product Area -->
    {% for product in requested %}
      <div class=" ">
                <div class=" " style="width: 100%; float: none;" >
                    <div class="" style="float: left; width: 30%;">
                        
     
                        <img src="{{product.product.image.url}}" alt="" style="height: 150px;">
                    </div>
                    <div class="">
                        <h5 class="product-price" ><b>{{product.name}} </b> </h5>
                        <h5 class="product-price" > <b> Package Number:{{product.package_number}} </b> </h5>
                        <h6 class="product-name"style="float: right; padding:5px;">Status: {{product.status|title}}  </h6>
                        
                        <h6 class="product-name" >Price: &#8358;{{product.price}}</h6>
                        <h6 class="product-name" >Quantity: {{product.quantity}}</h6>
                        <h6 class="product-price">Size Requested: {{obj.size}} </h6>
                        <h6 class="product-price">Color Requested: {{obj.color}} </h6>
                        <!-- <a href="#d" class="btn btn-primary"style="float: right; padding:5px; border-color: #30323A; background-color: #30323A;">Ship Package  </a> -->
                        <h6 class="product-name" style=" padding:5px;"> Date Requested: {{product.package_time}} </h6>
                        <h6 class="product-name" style=" padding:5px;"> Delivery Address: {{product.user.deliverydetails.street}}, {{product.user.deliverydetails.state}}, {{product.user.deliverydetails.country}}</h6>
                        <h6 class="product-name" style=" padding:5px;"> Customer Name: {{product.user.deliverydetails.first_name}} {{product.user.deliverydetails.last_name}} </h6>
                        <h6 class="product-name" style=" padding:5px;"> Customer's Phone Number: {{product.user.deliverydetails.number}} </h6>
                        <p>Package should be delivered within five working days.</p>
                        {% if product.status == "requested" %}
                        <form method="POST" class="input-group ship-package" >
                            {% csrf_token %}
                            <input type="hidden" id="saleId" value="{{product.id}}" />
                            <input type="text" name="sale-text" class="form-control" id="saleMsg" placeholder="Who is delivering the package, when it is expected to get to the customer and delivery agent contact(optional)" />
                            <input type="submit"class="btn btn-primary" style="border-color: #30323A; background-color: #30323A;" value="Ship Package" />
                        </form>
                        {% endif %}
                        
                        
                        
                    </div>
                </div>
            </div>
            <br/>
            
{% endfor %}

    </div>
</div>
</section>


    <div class="aside">
        <h3 class="aside-title">Top Sales</h3>
        <!-- widget product -->
        
        <div class="product product-widget">
            {% for product in object_list %}
            <a href="/products/{{product.slug}}">
            <div >
                <img src="{{product.image.url}}" alt="">
            </div>
            <div class="product-body">
                <h2 class="product-name"><a href="/products/{{product.slug}}">{{product.name}}</a></h2>
                <h3 class="product-price">&#8358;{{product.price}} <del class="product-old-price">&#8358;{{product.discounted_from}}</del></h3>
                
            </div>
            </a>
            {% endfor %}
            
            
        </div>
        <!-- /widget product -->
</div>
        
{% endblock content %}
{% block formadjust %}

<script>
   
    $('.ship-package').each(function(key,obj){
       var saleId=$(this).children("#saleId").val();
       $(this).on("submit", function(event){
           event.preventDefault();
        var shipMsg=$(obj).children("#saleMsg").val();
        datum={
                "status":"shipped",
                "sale_id":saleId,
                "ship_msg":shipMsg,
                "csrfmiddlewaretoken":"{{csrf_token}}"
            }
            myRespond(datum);
            $(obj).css("display","none")
       });
       

    });
    function myRespond(datum){
          
          $.ajax({
               type:'POST',
               url:"/record/customer-response/",
               data:datum,
               success:function(data){
                 alert('successfully: The Product Has Been'+data.status)
               },
               error:function(err){
                   alert('error :'+err);
               }
               
           });
      }
    
    
    // inputArea.keyup(function(){
    //     var withdrawAmmountValue=$(this).val();
    //     if(parseInt(withdrawAmmountValue) >= savingsBalance){
    //         var x="<p> You Don't have upto "+withdrawAmmountValue+" in your account</p>";
    //         document.getElementById('id_ammount_alert').innerHTML= x;
        
    // };
    // });
    
    </script>
{% endblock formadjust %}